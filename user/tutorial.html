

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial &mdash; QCoDeS 0.6.0+143.gb28ed3820 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Configuring QCoDeS" href="configuration.html" />
    <link rel="prev" title="QCodes FAQ" href="faq.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> QCoDeS
          

          
          </a>

          
            
            
              <div class="version">
                0.6.0+143.gb28ed3820
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../start/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help.html">Get Help</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html">QCodes FAQ</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#writing-a-driver">Writing a Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#measuring">Measuring</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation">Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#combined-parameters-sweep">Combined Parameters Sweep</a></li>
<li class="toctree-l3"><a class="reference internal" href="#meta-instruments">Meta Instruments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#async-meta">Async Meta</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advanced">Advanced</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Configuring QCoDeS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Community Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataset/index.html">DataSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">QCoDes API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/generated/qcodes.instrument_drivers.html">qcodes.instrument_drivers package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changes/index.html">Changelogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples of using QCoDeS</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">QCoDeS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">User Guide</a> &raquo;</li>
        
      <li>Tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/user/tutorial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="tutorial">
<span id="id1"></span><h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="writing-a-driver">
<span id="driver"></span><h2>Writing a Driver<a class="headerlink" href="#writing-a-driver" title="Permalink to this headline">¶</a></h2>
<p>First look at what parameters are and how to create them: <a class="reference external" href="https://github.com/QCoDeS/Qcodes/blob/master/docs/examples/Parameters/Parameters.ipynb">qcodes parameter</a> .</p>
<p>Then check out the walk-through to write your first driver:  <a class="reference external" href="https://github.com/QCoDeS/Qcodes/blob/master/docs/examples/Creating%20Instrument%20Drivers.ipynb">qcodes instrument</a> .</p>
</div>
<div class="section" id="measuring">
<h2>Measuring<a class="headerlink" href="#measuring" title="Permalink to this headline">¶</a></h2>
<p>Browse the   <a class="reference external" href="https://github.com/QCoDeS/Qcodes/blob/master/docs/examples/Measure%20without%20a%20Loop.ipynb">example</a> .</p>
</div>
<div class="section" id="simulation">
<span id="id2"></span><h2>Simulation<a class="headerlink" href="#simulation" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition" id="id3">
<p class="admonition-title">Todo</p>
<p>missing</p>
</div>
</div>
<div class="section" id="combined-parameters-sweep">
<h2>Combined Parameters Sweep<a class="headerlink" href="#combined-parameters-sweep" title="Permalink to this headline">¶</a></h2>
<p>If you want to sweep multiple parameters at once qcodes offers the combine function.
You can combine any number of any kind paramter.
We’ll use a ManualParameter for this example.
One can use both an array, or a set of arrays to pass the setpoint.
We’ll cover both cases in this example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">qcodes.instrument.parameter</span> <span class="kn">import</span> <span class="n">ManualParameter</span>
<span class="kn">from</span> <span class="nn">qcodes.utils.validators</span> <span class="kn">import</span> <span class="n">Numbers</span>

<span class="n">gate</span> <span class="o">=</span> <span class="n">ManualParameter</span><span class="p">(</span><span class="s1">&#39;gate&#39;</span><span class="p">,</span> <span class="n">vals</span><span class="o">=</span><span class="n">Numbers</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">frequency</span> <span class="o">=</span> <span class="n">ManualParameter</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="n">vals</span><span class="o">=</span><span class="n">Numbers</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">amplitude</span> <span class="o">=</span> <span class="n">ManualParameter</span><span class="p">(</span><span class="s1">&#39;amplitude&#39;</span><span class="p">,</span> <span class="n">vals</span><span class="o">=</span><span class="n">Numbers</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="c1"># a manual parameter returns a value that has been set</span>
<span class="c1"># so fix it to a value for this example</span>
<span class="n">amplitude</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">combined</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;gate_frequency&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>A name is required, and the combined parameter can now be swept
over, but we have to pass a list of values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># use an array with number_of_parameters x number of setpoints</span>
<span class="n">sweep_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">Loop</span><span class="p">(</span><span class="n">combined</span><span class="o">.</span><span class="n">sweep</span><span class="p">(</span><span class="n">sweep_vals</span><span class="p">),</span> <span class="n">delay</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="n">amplitude</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>the set operations are done sequentially, in this case first gate and then frequency is set.
If the operations are blocking, then the set will block.
Delay is counted for a step, not for a set. In this case set gate, set frequency and wait 0.0001</p>
</div>
<p>This will return this data:</p>
<dl>
<dt>DataSet:</dt><dd><blockquote>
<div><p>mode     = DataMode.LOCAL
location = ‘2016-10-19/23-05-10’</p>
</div></blockquote>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 33%" />
<col style="width: 27%" />
<col style="width: 23%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>&lt;Type&gt;</p></th>
<th class="head"><p>&lt;array_id&gt;</p></th>
<th class="head"><p>&lt;array.name&gt;</p></th>
<th class="head"><p>&lt;array.shape&gt;</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Setpoint</p></td>
<td><p>gate_frequency_set</p></td>
<td><p>gate_frequency</p></td>
<td><p>(2,)</p></td>
</tr>
<tr class="row-odd"><td><p>Measured</p></td>
<td><p>amplitude</p></td>
<td><p>amplitude</p></td>
<td><p>(2,)</p></td>
</tr>
<tr class="row-even"><td><p>Measured</p></td>
<td><p>gate</p></td>
<td><p>gate</p></td>
<td><p>(2,)</p></td>
</tr>
<tr class="row-odd"><td><p>Measured</p></td>
<td><p>frequency</p></td>
<td><p>frequency</p></td>
<td><p>(2,)</p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
<p>Where  gate_frequency_set contains just the sweep indices and the, perhaps confusingly
named measured gate and frequency contain the set data.</p>
<p>One can decide to save an aggregated version of the set values, instead of the setpoints
indices.
To do so one must define an aggregator. In the next example we sweep over x,y,z
and we save the sum of them.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">x</span> <span class="o">=</span> <span class="n">ManualParameter</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">vals</span><span class="o">=</span><span class="n">Numbers</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
 <span class="n">y</span> <span class="o">=</span> <span class="n">ManualParameter</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">vals</span><span class="o">=</span><span class="n">Numbers</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
 <span class="n">z</span> <span class="o">=</span> <span class="n">ManualParameter</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">vals</span><span class="o">=</span><span class="n">Numbers</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
 <span class="n">p4</span> <span class="o">=</span> <span class="n">ManualParameter</span><span class="p">(</span><span class="s1">&#39;p4&#39;</span><span class="p">,</span> <span class="n">vals</span><span class="o">=</span><span class="n">Numbers</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
 <span class="c1"># set so we can get a value back</span>
 <span class="n">p4</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>


 <span class="k">def</span> <span class="nf">linear</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
     <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">+</span><span class="n">z</span>

 <span class="n">magnet</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span>
                      <span class="n">name</span><span class="o">=</span><span class="s2">&quot;myvector&quot;</span><span class="p">,</span>
                      <span class="n">units</span><span class="o">=</span><span class="s2">&quot;T&quot;</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s2">&quot;magnetic field&quot;</span><span class="p">,</span>
                      <span class="n">aggregator</span><span class="o">=</span><span class="n">linear</span><span class="p">)</span>

 <span class="c1"># use number_of_parameters arrays with a length of number of setpoints</span>
 <span class="c1"># note that it will error if the length of the arrays are different</span>
 <span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
 <span class="n">y_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
 <span class="n">z_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

 <span class="n">loop</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">Loop</span><span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">sweep</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">y_vals</span><span class="p">,</span> <span class="n">z_vals</span><span class="p">),</span> <span class="n">delay</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="n">p4</span><span class="p">)</span>
 <span class="n">data</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>



<span class="n">data</span><span class="o">.</span><span class="n">myvector_set</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">array</span><span class="p">([</span> <span class="mf">3.</span><span class="p">,</span>  <span class="mf">6.</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="meta-instruments">
<span id="metainstrument"></span><h2>Meta Instruments<a class="headerlink" href="#meta-instruments" title="Permalink to this headline">¶</a></h2>
<p>The concept of a meta instrument is that of having
two separate Instrument, real or virtual, whose actions can
the be controlled from the meta instrument.
In the following example we will create two dummy instruments and a meta instrument.
All the instruments will live on an InstrumentServer.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>this is rather non-trival due to the limitation of the
current multiprocessing architecture</p>
</div>
<p>First we create an instrument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyInstrument</span><span class="p">(</span><span class="n">Instrument</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>  <span class="n">get_cmd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getx</span><span class="p">,</span> <span class="n">set_cmd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">setx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

    <span class="k">def</span> <span class="nf">setx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="n">val</span>
</pre></div>
</div>
<p>Then we create the meta instrument, this will hold any of the base
instruments.
Since we want the meta instrument to be able to talk to the base instruments
we need to include a list of them as shared_kwargs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Every InstrumentServer needs to have identical shared_kwargs among all the instruments loaded there. That’s because these args get loaded into the server when it’s created, then passed on to each instrument that’s loaded there during its construction on the server side.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">Instrument</span><span class="p">):</span>
    <span class="n">shared_kwargs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;instruments&#39;</span><span class="p">]</span>

    <span class="c1"># Instruments will be a list of RemoteInstrument objects, which can be</span>
    <span class="c1"># given to a server on creation but not later on, so it needs to be</span>
    <span class="c1"># listed in shared_kwargs</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">instruments</span><span class="o">=</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instrument_list</span> <span class="o">=</span> <span class="n">instruments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_instruments</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">instruments</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_instrument_list</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;c</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">gate</span><span class="p">,</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">,</span> <span class="n">gate</span><span class="o">=</span><span class="n">gate</span><span class="p">),</span>
                               <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">,</span> <span class="n">gate</span><span class="o">=</span><span class="n">gate</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s2">&quot;setBoth&quot;</span><span class="p">,</span> <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_both</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s2">&quot;setBothAsync&quot;</span><span class="p">,</span> <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_async</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_set_both</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument_list</span><span class="p">:</span>
            <span class="n">i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gate</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_instrument_list</span><span class="p">[</span><span class="n">gate</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Meta get gate </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">gate</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Meta set gate </span><span class="si">%s</span><span class="s1"> @ value </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument_list</span><span class="p">[</span><span class="n">gate</span><span class="p">]</span>
        <span class="n">i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s put these babies on servers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">BASESERVER</span> <span class="o">=</span> <span class="s2">&quot;foo&quot;</span>
<span class="n">base1</span> <span class="o">=</span> <span class="n">VirtualIVVI</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="n">server_name</span><span class="o">=</span><span class="n">BASESERVER</span><span class="p">)</span>
<span class="n">base2</span> <span class="o">=</span> <span class="n">VirtualIVVI</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="n">server_name</span><span class="o">=</span><span class="n">BASESERVER</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Instruments with no shared_kwargs  can go on the same or different servers.
That means that base1 and base2 don’t know about eachoter.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">meta_server_name</span> <span class="o">=</span> <span class="s2">&quot;meta_server&quot;</span>
<span class="n">meta</span> <span class="o">=</span> <span class="n">Meta</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;meta&#39;</span><span class="p">,</span> <span class="n">server_name</span><span class="o">=</span><span class="n">meta_server_name</span><span class="p">,</span>
                  <span class="n">instruments</span><span class="o">=</span><span class="p">[</span><span class="n">base1</span><span class="p">,</span> <span class="n">base2</span><span class="p">])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Meta instruments go on a different server from the
low-level instruments it references, because reasons.</p>
</div>
<p>And now one case use the meta as expected:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;--- set meta --- &quot;</span><span class="p">)</span>
<span class="n">meta</span><span class="o">.</span><span class="n">c1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">c1</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">25</span>
<span class="k">print</span><span class="p">(</span><span class="n">base1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">25</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;--- set base --- &quot;</span><span class="p">)</span>
<span class="n">base1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">c1</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">1</span>
<span class="k">print</span><span class="p">(</span><span class="n">base1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">1</span>

<span class="n">meta</span><span class="o">.</span><span class="n">setBoth</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">base1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">0</span>
<span class="k">print</span><span class="p">(</span><span class="n">base0</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="async-meta">
<h2>Async Meta<a class="headerlink" href="#async-meta" title="Permalink to this headline">¶</a></h2>
<p>Say you want to set two instruments at the same time.
You can use the following:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>the current architecture is so that you MUST one server per base instrument</p>
</div>
<p>The base instrument class stays the same, Meta gets a new method for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">Instrument</span><span class="p">):</span>
    <span class="n">shared_kwargs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;instruments&#39;</span><span class="p">]</span>

    <span class="c1"># Instruments will be a list of RemoteInstrument objects, which can be</span>
    <span class="c1"># given to a server on creation but not later on, so it needs to be</span>
    <span class="c1"># listed in shared_kwargs</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">instruments</span><span class="o">=</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instrument_list</span> <span class="o">=</span> <span class="n">instruments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_instruments</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">instruments</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_instrument_list</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;c</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">gate</span><span class="p">,</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">,</span> <span class="n">gate</span><span class="o">=</span><span class="n">gate</span><span class="p">),</span>
                               <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">,</span> <span class="n">gate</span><span class="o">=</span><span class="n">gate</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s2">&quot;setBoth&quot;</span><span class="p">,</span> <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_both</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s2">&quot;setBothAsync&quot;</span><span class="p">,</span> <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_async</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_set_both</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument_list</span><span class="p">:</span>
            <span class="n">i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">no_instruments</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument_list</span><span class="p">:</span>
                <span class="n">job</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">set</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
            <span class="n">futures</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gate</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_instrument_list</span><span class="p">[</span><span class="n">gate</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Meta get gate </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">gate</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Meta set gate </span><span class="si">%s</span><span class="s1"> @ value </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument_list</span><span class="p">[</span><span class="n">gate</span><span class="p">]</span>
        <span class="n">i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<dl>
<dt>This way:</dt><dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="o">.</span><span class="n">setBothAsync</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p>will set both instruments at the same time, say it takes 10 seconds per set,
then setting two things will take 10 seconds, not 20 seconds.</p>
<p>For a complete working example see <a class="reference download internal" download="" href="../_downloads/a23327ec52c3a7fe6425bc4574b6d6b4/meta.py"><code class="xref download docutils literal notranslate"><span class="pre">this</span> <span class="pre">example</span> <span class="pre">script</span></code></a>.</p>
</div>
<div class="section" id="advanced">
<h2>Advanced<a class="headerlink" href="#advanced" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition" id="id4">
<p class="admonition-title">Todo</p>
<p>missing</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="configuration.html" class="btn btn-neutral float-right" title="Configuring QCoDeS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="faq.html" class="btn btn-neutral float-left" title="QCodes FAQ" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>